<!DOCTYPE html>
<html>
<head>
    <title>Financial Data Visualization</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>

<div id="financialPlot" style="width:100%; height:1200px;"></div>

<script>
// Function to parse CSV data
function parseCSV(csvString) {
    const rows = csvString.trim().split('\n');
    const headers = rows.shift().split(',');
    return rows.map(row => {
        const values = row.split(',');
        const entry = {};
        headers.forEach((header, index) => {
            const cleanValue = values[index].trim(); // Trim whitespace
            entry[header] = !isNaN(cleanValue) ? parseFloat(cleanValue) : cleanValue; // Convert to float if numeric
        });
        return entry;
    });
}

fetch('breadthdata.csv')
.then(response => response.text())
.then(csvString => {
    const parsedData = parseCSV(csvString);

    const dates = parsedData.map(row => row['Date']);
    const closePrices = parsedData.map(row => row['close']); // Assuming 'close' is the correct column name
    const indexMSI = parsedData.map(row => row['Index (MSI)']); // Assuming 'Index (MSI)' is the correct column name
    const macd = parsedData.map(row => row['MACD']); // Assuming 'MACD' is the correct column name

    const layout = {
        title: 'Financial Data Visualization',
        grid: {rows: 3, columns: 1, pattern: 'independent'},
        xaxis: {title: 'Date', tickangle: -45},
        yaxis: {title: 'Close Prices', type: 'log'},
        xaxis2: {title: 'Date', anchor: 'y2', tickangle: -45},
        yaxis2: {title: 'Index (MSI)', autorange: true},
        xaxis3: {title: 'Date', anchor: 'y3', tickangle: -45},
        yaxis3: {title: 'MACD', autorange: true},
    };

    const traces = [
        {
            x: dates,
            y: closePrices,
            type: 'scatter',
            mode: 'lines',
            name: 'Close Prices',
            xaxis: 'x',
            yaxis: 'y'
        },
        {
            x: dates,
            y: indexMSI,
            type: 'bar',
            name: 'Index (MSI)',
            xaxis: 'x2',
            yaxis: 'y2'
        },
        {
            x: dates,
            y: macd,
            type: 'bar',
            name: 'MACD',
            xaxis: 'x3',
            yaxis: 'y3'
        }
    ];

    Plotly.newPlot('financialPlot', traces, layout);
})
.catch(error => console.error('Error loading the CSV file:', error));
</script>

</body>
</html>
