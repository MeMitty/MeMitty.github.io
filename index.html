<!DOCTYPE html>
<html>
<head>
    <title>Financial Data Visualization</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>

<div id="financialPlot" style="width:100%;height:800px;"></div>

<script>
fetch('breadthdata.csv')
    .then(response => response.text())
    .then(csvString => {
        // Split CSV into rows.
        var rows = csvString.trim().split('\n');
        
        // Extract header row.
        var headers = rows.shift().split(',');

        // Map rows to objects.
        var parsedData = rows.map(row => {
            var values = row.split(',');
            var entry = {};
            headers.forEach((header, index) => {
                entry[header] = values[index];
            });
            return entry;
        });

        // Extract columns.
        var dates = parsedData.map(row => row['Date']);
        var closePrices = parsedData.map(row => parseFloat(row['close'].replace(/,/g, '')));
        var indexMSI = parsedData.map(row => row['Index (MSI)'] ? parseFloat(row['Index (MSI)']) : null);
        var macd = parsedData.map(row => row['MACD'] ? parseFloat(row['MACD']) : null);

        // Define traces.
        var closeTrace = {
            x: dates,
            y: closePrices,
            type: 'scatter',
            mode: 'lines',
            name: 'Close Prices',
            xaxis: 'x',
            yaxis: 'y1'
        };

        var indexMSITrace = {
            x: dates,
            y: indexMSI,
            type: 'bar',
            name: 'Index (MSI)',
            marker: {color: 'blue'},
            xaxis: 'x',
            yaxis: 'y2'
        };

        var macdTrace = {
            x: dates,
            y: macd,
            type: 'bar',
            name: 'MACD',
            marker: {color: 'red'},
            xaxis: 'x',
            yaxis: 'y2'
        };

        // Define layout with separate y-axes.
        var layout = {
            title: 'Financial Data Visualization',
            xaxis: {title: 'Date'},
            yaxis: {
                title: 'Close Prices',
                type: 'log',
                side: 'left',
                overlaying: 'y2'
            },
            yaxis2: {
                title: 'Index (MSI) & MACD',
                side: 'right',
                position: 0.85
            },
            grid: {
                rows: 2,
                columns: 1,
                subplots: [['xy'], ['xy2']],
                roworder: 'top to bottom'
            },
            barmode: 'overlay'
        };

        Plotly.newPlot('financialPlot', [closeTrace, indexMSITrace, macdTrace], layout);
    })
    .catch(error => console.error('Error loading the CSV file:', error));
</script>

</body>
</html>
