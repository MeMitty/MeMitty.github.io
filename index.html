<!DOCTYPE html>
<html>
<head>
    <title>Financial Data Visualization</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>

<div id="financialPlot" style="width:100%;height:800px;"></div>

<script>
fetch('breadthdata.csv')
.then(response => response.text())
.then(csvString => {
    var rows = csvString.split('\n');
    var headers = rows.shift().split(',');

    var parsedData = rows.map(row => {
        var values = row.split(',');
        var entry = {};
        headers.forEach((header, index) => {
            if (header.toLowerCase() === 'date') {
                // Convert 'dd-mm-yyyy' to 'yyyy-mm-dd'
                var dateParts = values[index].split('-');
                entry[header] = `${dateParts[2]}-${dateParts[1]}-${dateParts[0]}`;
            } else {
                entry[header] = values[index];
            }
        });
        return entry;
    });
        
        var dates = data.slice(1).map(row => row[0]);
        var closePrices = data.slice(1).map(row => Number(row[1].replace(/,/g, '')));
        var indexMSI = data.slice(1).map(row => row[2] ? Number(row[2]) : null);
        var macd = data.slice(1).map(row => row[3] ? Number(row[3]) : null);

        var closeTrace = {
            x: dates,
            y: closePrices,
            xaxis: 'x',
            yaxis: 'y',
            type: 'scatter',
            mode: 'lines',
            name: 'Close Prices'
        };

        var indexMSITrace = {
            x: dates,
            y: indexMSI,
            xaxis: 'x2',
            yaxis: 'y2',
            type: 'bar',
            name: 'Index (MSI)',
            marker: {color: 'blue'}
        };

        var macdTrace = {
            x: dates,
            y: macd,
            xaxis: 'x2',
            yaxis: 'y2',
            type: 'bar',
            name: 'MACD',
            marker: {color: 'red'}
        };

		var layout = {
			title: 'Financial Data Visualization',
			// Adjust your axes configurations as needed
			xaxis: {
				title: 'Date',
				tickformat: "%d-%m-%Y", // Adjust if you want to display dates in a specific format
				dtick: "M1", // Month intervals should work after conversion
				rangeslider: {visible: true}
			},
			yaxis: {
				title: 'Close Prices',
				type: 'log',
				autorange: true
			},
			xaxis2: {
				domain: [0, 1],
				anchor: 'y2',
				title: 'Date',
				tickmode: 'auto',
				nticks: 20, // Adjust for the second graph as well
			},
			yaxis2: {
				title: 'Index (MSI) & MACD',
				anchor: 'x2'
			},
			barmode: 'overlay'
};

        Plotly.newPlot('financialPlot', [closeTrace, indexMSITrace, macdTrace], layout);
    })
    .catch(error => console.error('Error loading the CSV file:', error));
</script>

</body>
</html>
